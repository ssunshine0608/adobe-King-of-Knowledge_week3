<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Adobe 知識王 Week3</title>

  <!-- LIFF -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <!-- React / Babel / Tailwind -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #050510;
      overflow: hidden;                /* ✅ 整頁不讓上下滑 */
      overscroll-behavior: none;
      -webkit-text-size-adjust: 100%;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "PingFang TC", "Noto Sans TC", "Microsoft JhengHei", sans-serif;
    }
    #root { height: 100%; }

    /* ✅ 滿版背景（你的 background.jpg） */
    .fullbg {
      position: fixed;
      inset: 0;
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      transform: translateZ(0);
      will-change: transform;
      z-index: -2;
    }
    .bg-dim {
      position: fixed;
      inset: 0;
      background: radial-gradient(1200px 900px at 50% 10%, rgba(0,0,0,0.10), rgba(0,0,0,0.70));
      z-index: -1;
      pointer-events: none;
    }

    .safe-wrap{
      height: 100svh;
      height: 100dvh;
      padding-top: calc(12px + var(--safe-top));
      padding-bottom: calc(12px + var(--safe-bottom));
      padding-left: calc(12px + var(--safe-left));
      padding-right: calc(12px + var(--safe-right));
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* 進場下滑 / 退場左滑 */
    .enter-down { animation: enterDown 520ms cubic-bezier(.2,.9,.2,1) both; }
    @keyframes enterDown {
      from { transform: translateY(-18px); opacity: 0; }
      to   { transform: translateY(0); opacity: 1; }
    }
    .exit-left { animation: exitLeft 420ms cubic-bezier(.3,.0,.2,1) both; }
    @keyframes exitLeft {
      from { transform: translateX(0); opacity: 1; }
      to   { transform: translateX(-28px); opacity: 0; }
    }

    /* ✅ 題目圖滿版：固定在畫面內（不撐出滾動） */
    .img-fit {
      width: 100%;
      max-height: calc(100dvh - 170px); /* 預留按鈕區高度 */
      object-fit: contain;
      display: block;
      user-select: none;
      -webkit-user-drag: none;
      pointer-events: none; /* 點擊交給熱區 */
    }

    /* ✅ 四象限點擊熱區（等同你 week2 點插圖選項的感覺） */
    .hotspot {
      position: absolute;
      border-radius: 18px;
      background: rgba(255,255,255,0.00);
      outline: 2px solid rgba(255,255,255,0);
      transition: background 120ms ease, outline 120ms ease;
      -webkit-tap-highlight-color: transparent;
    }
    .hotspot:active { background: rgba(255,255,255,0.10); }
    .hotspot.selected { outline: 2px solid rgba(255,255,255,0.95); background: rgba(255,255,255,0.06); }

    /* ✅ 解析頁：外層不滾，內容太長就卡片內滾 */
    .inner-scroll {
      max-height: calc(100dvh - 240px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding-right: 2px;
    }
    .inner-scroll::-webkit-scrollbar { width: 6px; }
    .inner-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.18); border-radius: 999px; }

    .btn-wrap { white-space: normal; line-height: 1.15; }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    /***********************
     * ✅ 你的檔案都在 repo 根目錄（正確路徑）
     ***********************/
    const ASSETS = {
      bg: "./background.jpg",
      cover: "./fengmian.jpg",
      qimg: ["./q1.jpg","./q2.jpg","./q3.jpg","./q4.jpg","./q5.jpg"],
    };

    const PANTONE_PAST_URL = "https://www.pantone.com/color-of-the-year";
    const MUST_FULL_SCORE_TO_REDEEM = true;

    /***********************
     * ✅ 題庫：只用答案判斷＋解析文字（題目本身不顯示）
     * 選項點擊順序固定：
     * 左上= A(0) / 右上= B(1) / 左下= C(2) / 右下= D(3)
     ***********************/
    const QUESTIONS = [
      {
        answerIndex: 3,
        answerText: "D. Adobe After Effects",
        explanation:
`Photoshop、Illustrator 與 Express 主要用於影像、插畫與視覺設計，
而 After Effects 則專注於動畫與動態影像製作，
並非以靜態圖片為主要應用場景。`
      },
      {
        answerIndex: 2,
        answerText: "C. 將 Runway Gen-4.5 整合至 Firefly",
        explanation:
`Adobe 宣布與 Runway 展開策略合作，
並將其最新的 Gen-4.5 影片模型整合至 Firefly，
以強化影片生成與創作流程的應用彈性。`
      },
      {
        answerIndex: 3,
        answerText: "D. Midjourney",
        explanation:
`Firefly 並非只使用單一模型，
而是整合多方生成模型來因應不同創作需求。
Midjourney 則為獨立平台，未整合於 Firefly 中。`
      },
      {
        answerIndex: 0,
        answerText: "A. 試算表數據分析",
        explanation:
`Firefly 主要聚焦於創意與視覺相關的生成內容，
包含圖片、向量圖形與文字視覺效果，
並非用於資料處理或數據分析用途。`
      },
      {
        answerIndex: 1,
        answerText: "B. Cloud Dancer（雲上舞白）",
        explanation:
`Pantone 每年都會公布一款年度代表色。
2026 年度代表色為 Cloud Dancer（雲上舞白）。
其他選項中：
2022 年度代表色：Very Peri（長春花藍）
2023 年度代表色：Viva Magenta（非凡洋紅）
2024 年度代表色：Peach Fuzz（柔和桃）`
      },
    ];

    function App(){
      const [page, setPage] = useState("cover"); // cover | quiz | review | result
      const [qIndex, setQIndex] = useState(0);
      const [answers, setAnswers] = useState(Array(QUESTIONS.length).fill(null));
      const [isLeaving, setIsLeaving] = useState(false);

      const score = useMemo(() => {
        return answers.reduce((acc, v, i) => acc + (v === QUESTIONS[i].answerIndex ? 1 : 0), 0);
      }, [answers]);

      // ✅ LIFF expand
      useEffect(() => {
        (async () => {
          try {
            if (!window.liff) return;
            const LIFF_ID = "2008592497-M8lBAPJW"; // 若 week3 用新 LIFF，再換這裡
            await liff.init({ liffId: LIFF_ID });
            await new Promise(r => setTimeout(r, 80));
            if (liff.isInClient()) liff.expand();
          } catch (e) {}
        })();
      }, []);

      function go(next){
        setIsLeaving(true);
        setTimeout(() => {
          setIsLeaving(false);
          setPage(next);
        }, 420);
      }

      function startQuiz(){
        setAnswers(Array(QUESTIONS.length).fill(null));
        setQIndex(0);
        go("quiz");
      }

      function pick(idx){
        const next = answers.slice();
        next[qIndex] = idx;
        setAnswers(next);
      }

      function nextQ(){
        if (qIndex < QUESTIONS.length - 1){
          setIsLeaving(true);
          setTimeout(() => {
            setIsLeaving(false);
            setQIndex(qIndex + 1);
          }, 420);
        } else {
          go("review");
        }
      }

      function prevQ(){
        if (qIndex === 0) return;
        setIsLeaving(true);
        setTimeout(() => {
          setIsLeaving(false);
          setQIndex(qIndex - 1);
        }, 420);
      }

      const pageClass = (isLeaving ? "exit-left" : "enter-down");
      const picked = answers[qIndex];

      return (
        <>
          <div className="fullbg" style={{ backgroundImage: `url(${ASSETS.bg})` }} />
          <div className="bg-dim" />

          <div className="safe-wrap">
            <div className={"w-full max-w-[520px] " + pageClass}>

              {page === "cover" && (
                <Card tight>
                  <div className="relative w-full rounded-[26px] overflow-hidden shadow-2xl">
                    <img src={ASSETS.cover} className="w-full h-auto block" alt="cover" />
                    <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-black/10 to-transparent"></div>
                    <div className="absolute bottom-4 left-4 right-4">
                      <div className="mt-3">
                        <Btn primary onClick={startQuiz}>開始挑戰 ▶</Btn>
                      </div>
                    </div>
                  </div>
                </Card>
              )}

              {page === "quiz" && (
                <Card>
                  {/* ✅ 不顯示題目文字，只顯示進度 */}
                  <div className="flex items-center justify-between">
                    <div className="text-white/90 text-sm font-extrabold">
                      {qIndex + 1}/{QUESTIONS.length}
                    </div>
                    <div className="text-white/70 text-sm">
                      得分：{score}
                    </div>
                  </div>

                  {/* ✅ 題目全圖 + 四象限點擊 */}
                  <div className="mt-3 relative w-full rounded-2xl overflow-hidden shadow-lg bg-black/20">
                    <img src={ASSETS.qimg[qIndex]} className="img-fit" alt={"q"+(qIndex+1)} />

                    {/* 左上 A */}
                    <button
                      className={"hotspot " + (picked===0 ? "selected" : "")}
                      onClick={() => pick(0)}
                      style={{ left:"4%", top:"6%", width:"44%", height:"40%" }}
                      aria-label="選 A"
                    />
                    {/* 右上 B */}
                    <button
                      className={"hotspot " + (picked===1 ? "selected" : "")}
                      onClick={() => pick(1)}
                      style={{ right:"4%", top:"6%", width:"44%", height:"40%" }}
                      aria-label="選 B"
                    />
                    {/* 左下 C */}
                    <button
                      className={"hotspot " + (picked===2 ? "selected" : "")}
                      onClick={() => pick(2)}
                      style={{ left:"4%", bottom:"6%", width:"44%", height:"40%" }}
                      aria-label="選 C"
                    />
                    {/* 右下 D */}
                    <button
                      className={"hotspot " + (picked===3 ? "selected" : "")}
                      onClick={() => pick(3)}
                      style={{ right:"4%", bottom:"6%", width:"44%", height:"40%" }}
                      aria-label="選 D"
                    />
                  </div>

                  <div className="mt-4 flex gap-3">
                    <Btn onClick={prevQ} disabled={qIndex===0}>← 上一題</Btn>
                    <Btn primary onClick={nextQ} disabled={answers[qIndex]===null}>
                      {qIndex===QUESTIONS.length-1 ? "看解析 ▶" : "下一題 ▶"}
                    </Btn>
                  </div>
                </Card>
              )}

              {page === "review" && (
                <Card>
                  <div className="text-white text-xl font-extrabold">整張解析</div>
                  <div className="text-white/80 text-sm mt-1">
                    先玩完再一次看解析（保留你喜歡的節奏）
                  </div>

                  {/* ✅ 解析內容放卡片內滾動（整頁不滾） */}
                  <div className="mt-4 inner-scroll grid gap-3">
                    {QUESTIONS.map((q, i) => {
                      const ok = answers[i] === q.answerIndex;
                      return (
                        <div key={i} className="rounded-2xl bg-white/10 p-4 border border-white/10">
                          <div className="flex items-start justify-between gap-3">
                            <div className="text-white font-extrabold">Q{i+1}</div>
                            <div className={
                              "shrink-0 text-xs font-extrabold px-2 py-1 rounded-full " +
                              (ok ? "bg-emerald-400 text-black" : "bg-rose-400 text-black")
                            }>
                              {ok ? "答對" : "答錯"}
                            </div>
                          </div>

                          <div className="mt-2 text-white/90 text-sm">
                            <span className="font-semibold">正確答案：</span>{q.answerText}
                          </div>

                          <div className="mt-2 text-white/75 text-sm whitespace-pre-line leading-relaxed">
                            <span className="font-semibold text-white/90">解析：</span>{"\n"}{q.explanation}
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  {/* ✅ 解析頁只留「看結果」 */}
                  <div className="mt-4">
                    <Btn primary onClick={() => go("result")}>看結果 ▶</Btn>
                  </div>
                </Card>
              )}

              {page === "result" && (
                <Card>
                  <div className="text-center">
                    <div className="text-white text-2xl font-extrabold">
                      你的得分：{score} / {QUESTIONS.length}
                    </div>

                    {MUST_FULL_SCORE_TO_REDEEM ? (
                      score === QUESTIONS.length ? (
                        <div className="text-emerald-300 mt-2 font-semibold">
                          滿分達成！可以領獎 ✅
                        </div>
                      ) : (
                        <div className="text-rose-300 mt-2 font-semibold">
                          差一點點～再玩一次拿滿分就能領獎！
                        </div>
                      )
                    ) : (
                      <div className="text-white/80 mt-2">感謝挑戰！</div>
                    )}
                  </div>

                  {/* ✅ 結果頁三顆按鈕（你要的第三顆在這裡） */}
                  <div className="mt-4 grid gap-3">
                    <Btn primary onClick={() => go("cover")}>再玩一次 ▶</Btn>

                    {MUST_FULL_SCORE_TO_REDEEM && (
                      <Btn
                        disabled={score !== QUESTIONS.length}
                        onClick={() => alert("把這裡換成你 Week2 的兌獎/分享流程即可")}
                      >
                        {score === QUESTIONS.length ? "分享並領取獎勵" : "需滿分才可領獎"}
                      </Btn>
                    )}

                    <Btn
                      onClick={() => window.open(PANTONE_PAST_URL, "_blank")}
                      className="btn-wrap"
                    >
                      前往探索 PANTONE<br className="sm:hidden" />歷年代表色
                    </Btn>
                  </div>
                </Card>
              )}

            </div>
          </div>
        </>
      );
    }

    function Card({ children, tight }){
      return (
        <div className={"mx-auto bg-black/35 backdrop-blur-md rounded-[28px] shadow-2xl border border-white/10 " + (tight ? "p-0" : "p-5")}>
          {children}
        </div>
      );
    }

    function Btn({ children, onClick, disabled, primary, className="" }){
      return (
        <button
          onClick={onClick}
          disabled={disabled}
          className={
            "w-full rounded-2xl px-4 py-3 font-extrabold transition active:scale-[0.99] " +
            (primary
              ? "bg-white text-black shadow-lg hover:shadow-xl"
              : "bg-white/14 text-white hover:bg-white/20") +
            (disabled ? " opacity-50 cursor-not-allowed" : "") +
            " " + className
          }
        >
          {children}
        </button>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
